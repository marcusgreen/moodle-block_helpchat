define("block_helpchat/form_integration",["exports","./dom_parser"],(function(_exports,_dom_parser){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.populateFormAnalysis=_exports.initFormIntegration=_exports.getFormSummary=_exports.getCurrentFormAnalysis=void 0;var _systemImportTransformerGlobalIdentifier="undefined"!=typeof window?window:"undefined"!=typeof self?self:"undefined"!=typeof global?global:{};const initFormIntegration=function(hiddenFieldId){let options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},debounceMs=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;void 0===window.MoodleDomParser?(console.warn("DOM Parser not available, loading..."),("function"==typeof _systemImportTransformerGlobalIdentifier.define&&_systemImportTransformerGlobalIdentifier.define.amd?new Promise((function(resolve,reject){_systemImportTransformerGlobalIdentifier.require(["./dom_parser.js"],resolve,reject)})):"undefined"!=typeof module&&module.exports&&"undefined"!=typeof require||"undefined"!=typeof module&&module.component&&_systemImportTransformerGlobalIdentifier.require&&"component"===_systemImportTransformerGlobalIdentifier.require.loader?Promise.resolve(require("./dom_parser.js")):Promise.resolve(_systemImportTransformerGlobalIdentifier["./dom_parser.js"])).then((_ref=>{let{makeGloballyAccessible:makeGloballyAccessible}=_ref;makeGloballyAccessible(),setupIntegration(hiddenFieldId,options,debounceMs)})).catch((error=>{console.error("Failed to load DOM parser:",error)}))):setupIntegration(hiddenFieldId,options,debounceMs)};_exports.initFormIntegration=initFormIntegration;const setupIntegration=async(hiddenFieldId,options,debounceMs)=>{try{await(0,_dom_parser.populateHiddenField)(hiddenFieldId,options),console.log("Form integration initialized successfully");const cleanup=(0,_dom_parser.autoPopulateHiddenField)(hiddenFieldId,options,debounceMs);window.M.block_ai_chat.cleanupFormIntegration=cleanup;const form=document.querySelector("form.moodleform");form&&form.addEventListener("submit",(async e=>{try{await(0,_dom_parser.populateHiddenField)(hiddenFieldId,options)}catch(error){console.error("Failed to populate hidden field before submission:",error)}}))}catch(error){console.error("Form integration setup failed:",error)}},populateFormAnalysis=async function(hiddenFieldId){let options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(void 0===window.MoodleDomParser)throw new Error("DOM Parser not available");return await(0,_dom_parser.populateHiddenField)(hiddenFieldId,options),console.log("Form analysis data populated manually"),!0}catch(error){return console.error("Manual form analysis failed:",error),!1}};_exports.populateFormAnalysis=populateFormAnalysis;const getCurrentFormAnalysis=hiddenFieldId=>{const hiddenField=document.getElementById(hiddenFieldId);if(!hiddenField||!hiddenField.value)return null;try{return JSON.parse(hiddenField.value)}catch(error){return console.error("Failed to parse form analysis data:",error),null}};_exports.getCurrentFormAnalysis=getCurrentFormAnalysis;const getFormSummary=hiddenFieldId=>{const analysis=getCurrentFormAnalysis(hiddenFieldId);if(!analysis||!analysis.elements)return null;const elements=analysis.elements;return{timestamp:analysis.timestamp,totalElements:elements.length,filledElements:elements.filter((el=>el.current_value&&""!==el.current_value.trim())).length,visibleElements:elements.filter((el=>1===el.visible)).length,hiddenElements:elements.filter((el=>0===el.visible)).length,formUrl:analysis.formUrl,elementTypes:{text:elements.filter((el=>["text","email","password"].includes(el.type))).length,select:elements.filter((el=>"select"===el.type)).length,textarea:elements.filter((el=>"textarea"===el.type)).length,checkbox:elements.filter((el=>"checkbox"===el.type)).length,radio:elements.filter((el=>"radio"===el.type)).length}}};_exports.getFormSummary=getFormSummary,void 0===M.block_ai_chat&&(M.block_ai_chat={}),M.block_ai_chat.initFormIntegration=initFormIntegration,M.block_ai_chat.populateFormAnalysis=populateFormAnalysis,M.block_ai_chat.getCurrentFormAnalysis=getCurrentFormAnalysis,M.block_ai_chat.getFormSummary=getFormSummary}));

//# sourceMappingURL=form_integration.min.js.map